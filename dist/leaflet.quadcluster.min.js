L.QuadCluster={version:"0.0.1"},function(){function a(a,c,d,e){function f(a){if(!a.active)return a.mass=0,void(a.center=L.latLng(0,0));for(var b=0,c=0,d=0,e=0;4>e;e++)if(a.nodes[e]&&a.nodes[e].active){var f=a.nodes[e].center.lat,g=a.nodes[e].center.lng,h=a.nodes[e].mass,i=d/(d+h),j=h/(d+h);b=b*i+f*j,c=c*i+g*j,d+=h}a.point&&(b=b*(d/(d+1))+point.x/(d+1),c=c*(d/(d+1))+point.y/(d+1),d+=1),a.mass=d,a.center=L.latLng(b,c),a.active=d>0}function g(a){if(a=a||[],!this.node.active)return a;this.point&&a.push(this.point);for(var b=0;b<this.nodes.length;b++)this.nodes[b]&&this.nodes[b].getPoints(a);return a}function h(a,b,c,d,e,i){var j=.5*(c+e),k=.5*(d+i),l=a.nodes;a.depth=b,a.bounds=L.latLngBounds([[c,d],[e,i]]),a.id||(a.id=q++,a.active=!0),l[0]&&(h(l[0],b+1,c,d,j,k),l[0].parentID=a.id),l[1]&&(h(l[1],b+1,j,d,e,k),l[1].parentID=a.id),l[2]&&(h(l[2],b+1,c,k,j,i),l[2].parentID=a.id),l[3]&&(h(l[3],b+1,j,k,e,i),l[3].parentID=a.id),f(a),a.getPoints=g}function i(a){var b=Math.abs(a.bounds.getEast()-a.bounds.getWest()),c=Math.abs(a.bounds.getNorth()-a.bound.getSouth());return b*c}var j=d3.geom.quadtree().x(c).y(d).extent(e),k=e[0][0],l=e[0][1],m=e[1][0],n=e[1][1],o=j(a),p={},q=1;return p.aggregate=function(a){var c=b(a,o,k,l,m,n);return null===c&&(c=a.initialize()),c},p.add=function(a){o.add(a),h(o,0,k,l,m,n)},p.root=function(){return o},p.filter=function(a){var b=L.QuadCluster.Aggregate().finalize(function(b,c){return c.active=a(c),f(c),b})();p.aggregate(b)},p.cut=function(a,b){a=L.latLngBounds(a);var c=L.QuadCluster.Aggregate().filter(function(c){if(!c.active)return!0;if(!a.contains(c.center))return!0;var d=i(c);return b/4>=d?!0:!1}).init(function(){return[]}).merge(function(a,b){return a.concat(b)}).finalize(function(a,b){return 0===a.length&&a.push(b),a})();return p.aggregate(c)},h(o,0,k,l,m,n),tree}function b(a,c){var d=null,e,f=c.nodes;return a.filter(c)||(d=a.initialize(),d=a.accumulate(d,c),f[0]&&(e=b(a,f[0]),null!==e&&(d=a.merge(d,e,0))),f[1]&&(e=b(a,f[1]),null!==e&&(d=a.merge(d,e,1))),f[2]&&(e=b(a,f[2]),null!==e&&(d=a.merge(d,e,2))),f[3]&&(e=b(a,f[3]),null!==e&&(d=a.merge(d,e,3))),d=a.finalize(d,c)),d}L.QuadCluster.Tree=function(){function b(a){if(0===a.length)throw new Error("Must specify an extent if no points given during initialization");var b=[1/0,-1/0],c=[1/0,-1/0];return a.forEach(function(a){var f=d(a),g=e(a);b[0]=Math.min(f,b[0]),b[1]=Math.min(g,b[1]),c[0]=Math.max(f,c[0]),c[1]=Math.max(g,c[1])}),[b,c]}function c(a){var b=a[0][0],c=a[0][1],d=a[1][0],e=a[1][1],f=d-b,g=e-c;return f>g?e=c+f:d=b+g,[[b,c],[d,e]]}var d=function(a){return a.x},e=function(a){return a.y},f=null,g=function(g){var h=f;return h||(h=b(g)),h=c(h),a(g,d,e,h)};return g.x=function(a){return 0===arguments.length?d:(d=a,g)},g.y=function(a){return 0===arguments.length?e:(e=a,g)},g.extent=function(a){return 0===arguments.length?f:(f=a,g)},g}}(),function(){function a(a,b,c,d,e){this.initialize=a,this.filter=b,this.merge=c,this.accumulate=d,this.finalize=e}L.QuadCluster.Aggregate=function(){var b=function(){return{}},c=function(){return!1},d=function(a){return a},e=function(a){return a},f=function(a){return a},g=function(){return new a(b,c,e,d,f)};return g.init=function(a){return 0===arguments.length?b:(b=a,g)},g.filter=function(a){return 0===arguments.length?c:(c=a,g)},g.accumulate=function(a){return 0===arguments.length?d:(d=a,g)},g.merge=function(a){return 0===arguments.length?e:(e=a,g)},g.finalize=function(a){return 0===arguments.length?f:(f=a,g)},g}}();
//# sourceMappingURL=leaflet.quadcluster.min.map